---
alwaysApply: true
---

# プロジェクト仕様

## 概要
日本の地方プロボノマッチングアプリケーション"ふるぼの"

## プロジェクトの目的
- 地方貢献に興味のある人材が、地方の中小企業や自治体のプロジェクトに応募することによって、プロボノマッチングを実現
- 求人は地方の中小企業や自治体が自ら書く。ガチガチの要件（納期や仕様）を書かせるのではなく、「想い」や「現状のモヤモヤ」を書いてもらうようにすることで、業務の切り出しの負荷を下げる。
- ログインしていないユーザーでも、どのような案件があるのかわかるようなサイトのUX。ログインしていないユーザーが応募するときには、ログインまたは会員登録が必要
- AIを活用したプロジェクト投稿フォーム入力補助機能（将来的に）
- 地方貢献に興味のある人材に対して、地方の中小企業や自治体がスカウトを送りマッチングする機能（将来的に）

## 技術スタック
- Laravel 12.x
- Livewire 3 + Volt (Functional)
- Flux UI Free
- Tailwind CSS v4
- Pest v4

## 認証システム
- Laravel Fortifyベースの認証（Livewire Starter Kit）
- 2要素認証対応
- セッション管理

## ルーティング規約
- リソースルート: 複数形（例: `/jobs`, `/applications`）
- 機能別ルート: 適切な命名（例: `/dashboard`, `/settings`）
- 認証必須ルート: `auth`ミドルウェア使用
- 名前付きルート必須
- **ルート定義の順序**: 具体的なパスを動的パスより前に配置すること
  - ✅ 正しい順序: `jobs/create` → `jobs/{jobPost}` → `jobs/{jobPost}/edit`
  - ❌ 間違った順序: `jobs/{jobPost}` → `jobs/create` (404エラーの原因)

## ロール機能

### ユーザーロール
- `company`: 企業ユーザー（求人投稿、応募管理）
- `worker`: ワーカーユーザー（求人応募、応募一覧）

### ロールベースミドルウェア
- ミドルウェア名: `role`
- 実装クラス: `App\Http\Middleware\EnsureUserHasRole`
- 使用方法: `->middleware('role:company')` または `->middleware('role:worker')`
- 不正アクセス時: 403エラー（Access Denied）

### ログイン後のリダイレクト
- すべてのユーザー: `/dashboard` にリダイレクト
- プロフィール登録の有無に関わらず共通

## UI設計ルール

### 未実装機能へのリンク表示
段階的な実装を進める際（詳細画面→編集画面→登録画面の順）、未実装機能へのリンクには以下のルールを適用：

- 未実装機能へのリンクには「（準備中）」の文言を追加
- リンクは無効化する（`disabled` 属性を使用）
- 実装完了後、「（準備中）」を削除し、正しいリンクを設定

**実装例**:
```blade
<!-- 未実装時 -->
<flux:button disabled>
    編集（準備中）
</flux:button>

<!-- 実装後 -->
<flux:button :href="route('jobs.edit', $job)" wire:navigate>
    編集
</flux:button>
```

**実装手順**:
1. 詳細画面作成時：編集・削除ボタンを「（準備中）」で実装
2. 編集画面作成時：編集ボタンを有効化、「（準備中）」を削除
3. 登録画面作成時：新規作成ボタンを有効化、「（準備中）」を削除

## ポリシーと認可
- 各モデルに対応するPolicyクラス作成
- アクション実行前の認可チェック必須
- `$this->authorize()`メソッド使用

## バリデーション
- Form Requestクラス使用必須
- インラインバリデーション禁止
- 日本語エラーメッセージ
- カスタムバリデーションルールは適切に分離

---

## 機能要件詳細

### 認証・アカウント管理

#### ログイン
- **ルート**: `GET/POST /login`
- **コンポーネント**: Fortify標準
- **機能**: メールアドレスとパスワードでログイン

#### ユーザー登録
- **ルート**: `GET/POST /register`
- **コンポーネント**: Fortify標準
- **機能**: 新規アカウント作成

#### パスワードリセット
- **ルート**: `GET/POST /password/reset`
- **コンポーネント**: Fortify標準
- **機能**: メール経由でのパスワードリセット

#### 2要素認証
- **ルート**: `/settings/two-factor`
- **コンポーネント**: `resources/views/livewire/settings/two-factor.blade.php`
- **機能**: 2FAの有効化・無効化、リカバリーコード管理

### 企業プロフィール管理

#### 企業登録画面
- **ルート**: `GET /company/register`、`POST /company/register`
- **ルート名**: `company.register`
- **コンポーネント**: `resources/views/livewire/company/register.blade.php`
- **ミドルウェア**: `auth`（認証済みユーザー向け）
- **機能**: 認証済みユーザーの企業プロフィール登録
- **入力項目**:
  - icon: アイコン画像(任意、画像アップロード)
  - location_id: 所在地（必須、2段階選択：都道府県→市区町村）
  - address: 所在地住所（必須、200文字以内）
  - representative: 担当者名（必須、50文字以内）
  - phone_number: 電話番号（必須、30文字以内）
- **処理**:
  - company_profilesテーブルにプロフィール登録
  - 登録成功後、企業詳細画面（company.profile）にリダイレクト
- **UI**:
  - 企業プロフィール情報のみを入力
  - 2段階選択（都道府県→市区町村）の実装
  - パソコン操作が苦手な事業者でもスマホで入力できるようにレスポンシブ対応する
- **注意**: 
  - ユーザー登録は事前にFortifyの標準登録画面で完了している前提
  - 既にプロフィールが登録されている場合は企業詳細画面にリダイレクト

#### 企業詳細画面
- **ルート**: `GET /company/profile`
- **ルート名**: `company.profile`
- **コンポーネント**: `resources/views/livewire/company/show.blade.php`
- **ミドルウェア**: `auth`, `role:company`
- **機能**: ログインユーザーの企業プロフィール表示
- **表示項目**: company_profilesテーブルの全項目
  - アイコン画像（丸くマスクした事業者ロゴ画像）
  - 企業名（users.name）
  - 所在地（都道府県 市区町村、例：東京都 千代田区）
  - 所在地住所
  - 担当者名
  - 担当者連絡先
  - 登録日時
  - 更新日時
- **アクション**: 編集画面へのリンク

#### 企業編集画面
- **ルート**: `GET /company/edit`
- **ルート名**: `company.edit`
- **コンポーネント**: `resources/views/livewire/company/edit.blade.php`
- **ミドルウェア**: `auth`, `role:company`
- **機能**: ログインユーザーの企業プロフィール編集
- **入力項目**: 企業プロフィール項目のみ（location_id, address, representative, phone_number）
- **処理**:
  - バリデーション後、company_profilesテーブルを更新
  - 更新成功後、企業詳細画面（company.profile）にリダイレクト
- **UI**:
  - 既存データを初期表示
  - 2段階選択（都道府県→市区町村）の実装
  - パソコン操作が苦手な事業者でもスマホで入力できるようにレスポンシブ対応する
- **注意**: 企業名（users.name）の変更は別途ユーザー情報編集機能で対応

#### 所在地の2段階選択仕様
- **都道府県選択**:
  - locationsテーブルから`city IS NULL`のデータを取得
  - `code`の昇順でソート
- **市区町村選択**:
  - 選択された都道府県に対応する市区町村を取得
  - `prefecture`が選択された都道府県と一致し、`city IS NOT NULL`のデータ
  - `code`の昇順でソート
- **連動動作**:
  - 都道府県を変更すると、市区町村の選択肢が更新される
  - 都道府県を変更すると、市区町村の選択はリセットされる

### ワーカープロフィール管理

#### ワーカー登録画面
- **ルート**: `GET /worker/register`、`POST /worker/register`
- **ルート名**: `worker.register`
- **コンポーネント**: `resources/views/livewire/worker/register.blade.php`
- **ミドルウェア**: なし（未認証ユーザー向け）
- **機能**: ユーザー登録とワーカープロフィールを同時登録
- **入力項目**:
  - name: 氏名（必須）
  - handle_name: ハンドルネーム（必須）
  - email: メールアドレス（必須、ユニーク）
  - password: パスワード（必須、8文字以上）
  - password_confirmation: パスワード確認（必須）
  - icon: アイコン画像(任意、画像アップロード)
  - gender: 性別（必須、ラジオボタン：male, female, other）
  - birthdate: 生年月日（必須、年月日ドロップダウン）
  - experiences: これまでの経験（任意、日本語200文字以内、テキストエリア）
  - want_to_do: これからやりたいこと（任意、日本語200文字以内、テキストエリア）
  - good_contribution: 得意なことや貢献できること（任意、日本語200文字以内、テキストエリア）
  - birth_location_id: 出身地（必須、2段階選択：都道府県→市区町村）
  - current_location_1_id: 現在のお住まい1（必須、2段階選択：都道府県→市区町村）
  - current_location_2_id: 現在のお住まい2（任意、2段階選択：都道府県→市区町村）
  - favorite_location_1_id: 移住に関心のある地域1（任意、2段階選択：都道府県→市区町村）
  - favorite_location_2_id: 移住に関心のある地域2（任意、2段階選択：都道府県→市区町村）
  - favorite_location_3_id: 移住に関心のある地域3（任意、2段階選択：都道府県→市区町村）
  - available_action: 興味のあるお手伝い（任意、チェックボックス:mowing, snowplow, diy, localcleaning, volunteer）
- **処理**:
  - usersテーブルにユーザー登録（role='worker'、name=氏名）
  - worker_profilesテーブルにプロフィール登録
  - 登録成功後、ワーカー詳細画面（worker.profile）にリダイレクト
- **UI**:
  - ユーザー情報とワーカープロフィール情報を1画面で入力
  - 年月日ドロップダウンの動的生成
  - 2段階選択（都道府県→市区町村、任意）の実装

#### ワーカー詳細画面
- **ルート**: `GET /worker/profile`
- **ルート名**: `worker.profile`
- **コンポーネント**: `resources/views/livewire/worker/show.blade.php`
- **ミドルウェア**: `auth`, `role:worker`
- **機能**: ログインユーザーのワーカープロフィール表示
- **表示項目**: worker_profilesテーブルの全項目
  - ハンドルネーム（handles.name）
  - アイコン画像（丸くマスクしたプロフィール画像）
  - 性別（日本語表示：male=男性、female=女性、other=その他）
  - 生年月日と年齢（例：1990年5月15日（34歳））
  - これまでの経験(200文字までのテキスト)
  - これからやりたいこと(200文字までのテキスト)
  - 得意なことや貢献できること(200文字までのテキスト)
  - 現在のお住まい1（都道府県 市区町村、NULL時は「未設定」）
  - 現在のお住まい2（都道府県 市区町村、NULL時は「未設定」）
  - 移住に関心のある地域1（都道府県 市区町村、NULL時は「未設定」）
  - 移住に関心のある地域2（都道府県 市区町村、NULL時は「未設定」）
  - 移住に関心のある地域3（都道府県 市区町村、NULL時は「未設定」）
  - 興味のあるお手伝い（複数選択可能、日本語表示:mowing=草刈り, snowplow=雪かき, localcleaning=地域清掃, diy=DIY, volunteer=災害ボランティア）
  - 登録日時
  - 更新日時
- **アクション**: 編集画面へのリンク

#### ワーカー編集画面
- **ルート**: `GET /worker/edit`
- **ルート名**: `worker.edit`
- **コンポーネント**: `resources/views/livewire/worker/edit.blade.php`
- **ミドルウェア**: `auth`, `role:worker`
- **機能**: プロフィール編集
- **入力項目**: ワーカープロフィール項目のみ（gender, birthdate, skills, experiences, desired_jobs, desired_location_id）
- **処理**:
  - バリデーション後、worker_profilesテーブルを更新
  - 更新成功後、ワーカー詳細画面（worker.profile）にリダイレクト
- **注意**: 氏名（users.name）の変更は別途ユーザー情報編集機能で対応

#### 生年月日の年月日選択仕様
- **年選択**: 現在年 - 18歳 から 現在年 - 80歳 まで（降順）
- **月選択**: 1月〜12月
- **日選択**: 選択された年月に応じて動的に生成
  - 1, 3, 5, 7, 8, 10, 12月: 1〜31日
  - 4, 6, 9, 11月: 1〜30日
  - 2月: 閏年判定（28日または29日）
- **連動動作**:
  - 年または月を変更すると、日の選択肢が更新される
  - 選択中の日が新しい日数を超える場合、日選択はリセット

#### 地域の2段階選択仕様（任意）
- **都道府県選択**:
  - locationsテーブルから`city IS NULL`のデータを取得
  - `code`の昇順でソート
  - 「選択しない」オプションあり
- **市区町村選択**:
  - 選択された都道府県に対応する市区町村を取得
  - `prefecture`が選択された都道府県と一致し、`city IS NOT NULL`のデータ
  - `code`の昇順でソート
  - 「選択しない」オプションあり
- **連動動作**:
  - 都道府県を変更すると、市区町村の選択肢が更新される
  - 都道府県を変更すると、市区町村の選択肢が更新される
  - 都道府県を変更すると、市区町村の選択はリセットされる
  - 都道府県を「選択しない」にすると、市区町村も「選択しない」になる

### 募集管理

#### 募集一覧画面
- **ルート**: `GET /jobs`
- **ルート名**: `jobs.index`
- **コンポーネント**: `resources/views/livewire/jobs/index.blade.php`
- **ミドルウェア**: なし（誰でも閲覧可能）
- **機能**: 全募集の一覧表示
- **表示内容**:
  - 募集カード一覧（最新順）
  - 各カードに表示する情報:
    - アイキャッチ画像（aspect-video）
    - 募集形態タグ（青色バッジ）
    - 希望タグ（最大2つ、ハッシュタグ形式、グレーバッジ）
    - 「いつまでに」ラベル（赤色バッジ）
    - やりたいこと（見出し、2行まで）
    - 事業内容（90文字まで、3行まで）
    - できますタグ（最大3つ、緑色バッジ）
    - 企業名と所在地（アイコン付きラベル）
- **アクション**:
  - 企業ユーザーのみ: 「新規募集投稿」ボタン表示（jobs.create へ遷移）
  - 全募集カード: クリックで募集詳細画面（jobs.show）へ遷移
- **リレーション**:
  - company.companyProfile.location、jobType を先読み込み（N+1問題回避）
- **UI**:
  - レスポンシブ対応（モバイル1列、タブレット2列、デスクトップ3列）
  - カードホバー時に拡大・影を強調
  - 募集がない場合は空状態メッセージを表示

#### 募集詳細画面
 - **ルート**: `GET /jobs/{jobPost}`
 - **ルート名**: `jobs.show`
 - **コンポーネント**: `resources/views/livewire/jobs/show.blade.php`
 - **ミドルウェア**: なし（誰でも閲覧可能、ログイン不要）
 - **機能**: 募集詳細表示、応募ボタン、編集・削除ボタン
 - **表示内容**:
   - job_postsテーブルの全情報
   - リレーション情報（企業名、所在地）
   - アイキャッチ画像（eyecatch）
   - 募集形態タグ（job_type_id、青色バッジ）
   - 希望タグ（want_you_ids、ハッシュタグ形式、グレーバッジ）
   - 「いつまでに」ラベル（howsoon、赤色バッジ、目立つ表示）
   - やりたいこと（job_title、見出し）
   - 事業内容・困っていること（job_detail、全文表示）
   - 御礼にタグ（can_do_ids、緑色バッジ）
   - 企業名と所在地（アイコン付きラベル）
   - 投稿日時（posted_at）
 - **アクション**:
   - ワーカーユーザー（認証済み）: 
     - 未応募の場合: 「応募する」ボタン（jobs.apply へ遷移）
     - 応募済みの場合: 「✓ 応募済み」バッジ表示（緑色、ボタン無効化）
   - 企業ユーザー（自社求人のみ）: 「編集」ボタン（jobs.edit へ遷移）
   - 企業ユーザー（自社求人のみ）: 「削除」ボタン（削除確認モーダル表示）
   - ゲストユーザー（未認証）: 「応募する」ボタンをクリックするとログイン画面へ遷移
 - **削除機能**:
   - 削除確認モーダル表示（「本当に削除しますか？」）
   - 削除後は募集一覧（jobs.index）にリダイレクト
   - 成功メッセージ「募集を削除しました。」を表示
 - **ポリシー**: `view`アクション（誰でも閲覧可能、未認証ユーザーもOK）
 - **UI**:
   - レスポンシブ対応（スマホでも見やすい）
   - カード型レイアウト
   - 戻るボタン（募集一覧へ）
   - 削除確認モーダル（Flux UI Modal使用）
 - **リレーション**:
   - company.companyProfile.location を先読み込み（N+1問題回避）
   - jobType を先読み込み
   - ワーカーユーザーの場合、自分の応募状況も確認
 
 #### 募集登録画面
 - **ルート**: `GET /jobs/create`
 - **ルート名**: `jobs.create`
 - **コンポーネント**: `resources/views/livewire/jobs/create.blade.php`
 - **ミドルウェア**: `auth`, `role:company`
 - **機能**: 新規募集投稿
 - **入力項目**:
   - eyecatch: アイキャッチ画像（任意、画像アップロード）
   - howsoon: いつまでに（必須、ラジオボタン：いつか / いますぐにでも / ◯月までに、 "◯月までに"を選択しようとすると、「プロプランに変更してください」というバリデーションメッセージを表示）
   - job_title: やりたいこと（必須、日本語50文字以内、テキストエリア、"〇〇したい"とプレースホルダーで表示）
   - job_detail: 事業内容・困っていること（必須、日本語200文字以内、テキストエリア、"〇〇をしています。✕✕をやりたいが、△△なのでできていません"とプレースホルダーで表示）
   - job_type_id: 募集（必須、ラジオボタン、codesテーブルtype=1、"
採用(有償/雇用)"、"地域おこし協力隊"を選択しようとすると、それぞれ「雇用を目的とした募集はプロプランに変更してください」「地域おこし協力隊募集はプロプランに変更してください」というバリデーションメッセージを表示し、選択をリセット）
   - want_you_id: 希望（任意、チェックボックス、codesテーブルtype=2）
   - job_type_id: できます（任意、チェックボックス、codesテーブルtype=3）
 - **自動設定項目**:
   - company_id: ログインユーザーのID
   - posted_at: 現在日時
 - **バリデーション**（Form Request使用）:
   - job_title: required, max:50
   - job_detail: required, max:200
 - **UI**:
  - パソコン操作が苦手な事業者でもスマホで入力できるようにレスポンシブ対応する
 - **処理**:
   - バリデーション後、job_postsテーブルに登録
   - 登録成功後、募集詳細画面（jobs.show）にリダイレクト（プレビュー表示）
   - 成功メッセージ「募集を投稿しました。」を表示
 - **ポリシー**: `create`アクション（企業ユーザーのみ）
 
 #### 募集編集画面
 - **ルート**: `GET /jobs/{jobPost}/edit`
 - **ルート名**: `jobs.edit`
 - **コンポーネント**: `resources/views/livewire/jobs/edit.blade.php`
 - **ミドルウェア**: `auth`, `role:company`
 - **機能**: 既存求人の編集（自社求人のみ）
 - **入力項目**: 求人登録画面と同じ
 - **既存データ**: プリフィル（初期表示）
   - 勤務地は既存location_idから都道府県と市区町村を取得して表示
 - **posted_at**: 編集時は更新しない（既存値を保持）
 - **バリデーション**: 求人登録画面と同じ
 - **処理**:
   - バリデーション後、job_postsテーブルを更新
   - 更新成功後、求人詳細（jobs.show）にリダイレクト
 - **ポリシー**: `update`アクション（自社求人のみ）
 - **2段階選択の実装**:
   - 都道府県選択時に`wire:model.live="prefecture_id"`を使用
   - prefecture_idが変更されたら市区町村ドロップダウンを動的に更新
   - 市区町村はupdatedPrefectureId()メソッド内で絞り込み
   - mount時に既存のlocation_idから都道府県IDを取得してprefecture_idを設定
### 応募管理

#### 応募画面（ワーカー向け）
- **ルート**: `GET /jobs/{jobPost}/apply`
- **ルート名**: `jobs.apply`
- **コンポーネント**: `resources/views/livewire/jobs/apply.ade.php`
- **ミドルウェア**: `auth`, `role:worker`
- **機能**: 募集への応募
- **表示内容**:
  - 募集情報のサマリー（アイキャッチ画像、やりたいこと、期待するサポート、できます、事業者名、所在地など）
  - メッセージ入力欄（textarea）
- **重複応募チェック**:
  - 既に応募済みの場合は応募不可（ポリシーで制御）
  - 応募画面にアクセスした時点で応募済みの場合はエラーまたはリダイクト
- **入力項目**:
  - motive: メッセージ（任意、1000文字以内、テキストエリア）
- **応募確認モーダル**:
  - 「応募する」ボタンクリック時に確認モーダル表示
  - 「本当に応募しますか？」
- **自動設定項目**:
  - job_id: パラメータから取得
  - worker_id: ログインユーザーID
  - status: 'applied'
  - applied_at: 現在日時
- **バリデーション**（Form Request使用）:
  - motive: nullable, max:1000
- **処理**:
  - バリデーション後、job_applicationsテーブルに登録
  - 登録成功後、求人詳細画面（jobs.show）にリダイレクト
- **ポリシー**: `create`アクション（ワーカーのみ、重複応募不可）

#### 応募済み表示機能（既存画面の更新）
- **対象画面**: 
  - 募集一覧画面（jobs.index）
  - 募集詳細画面（jobs.show）
- **ワーカーユーザーのみ表示**:
  - ログインユーザーが応募済みの求人に「応募済み」バッジを表示
  - バッジは目立つ色（例: 青、緑）で表示
- **募集一覧画面での表示**:
  - 各求人カードに応募済みバッジを表示（応募済みの場合のみ）
  - カード右上または適切な位置に配置
- **募集詳細画面での表示**:
  - 応募済みの場合、「応募する」ボタンの代わりに「応募済み」バッジ表示
  - または「応募する」ボタンを無効化し、その横に「応募済み」バッジ表示
  - 応募済みの場合、「応募する」ボタンをクリックできないようにする
- **実装方法**:
  - ワーカーユーザーの場合、ログインユーザーの応募状況を確認
  - `JobApplication::where('job_id', $jobPost->id)->whereworker_id', auth()->id())->exists()`
  - 求人一覧では、N+1問題回避のため応募データを先読み込み
  - `JobPost::with(['applications' => fn($q) => $q->where('worker_id', auth()->id())])`
### 募集投稿管理

#### 募集一覧画面
- **ルート**: `GET /jobs`
- **ルート名**: `jobs.index`
- **コンポーネント**: `resources/views/livewire/jobs/index.blade.php`
- **ミドルウェア**: `auth`
- **機能**: 全募集一覧表示、検索・フィルタ機能
- **表示内容**:
  - 全募集をカード形式で一覧表示
  - アイキャッチ画像、やりたいこと、期待するサポート、できます、事業者名、所在地など
  - ページネーション: 1ページ12件
- **検索・フィルタ機能**:
  - キーワード検索: タイトル、詳細内容（LIKE検索）
  - 所在地フィルタ: 2段階選択（都道府県→市区町村、任意）
    - 都道府県: locationsテーブル（`city IS NULL`）、codeの昇順
    - 市区町村: 選択された都道府県に対応する市区町村（`city IS NOT NULL`）、codeの昇順
    - 都道府県を変更すると市区町村がリセット
    - 両方とも「選択しない」オプションあり
  - 募集形態フィルタ: チェックボックス（codesテーブルtype=1）
  - 希望形態フィルタ: チェックボックス（codesテーブルtype=2）
  - できますフィルタ: チェックボックス（codesテーブルtype=3）
- **アクション**:
  - 企業ユーザーのみ: 「新規求人投稿」ボタン表示（jobs.create へ遷移）
  - 全求人カード: クリックで求人詳細画面（jobs.show）へ遷移
- **リレーション**:
  - company（企業）、location（所在地）を先読み込み（N+1問題回避）
 #### 募集詳細画面
 - 「募集管理」セクションの募集詳細画面を参照
 
 #### 募集登録画面
 - **ルート**: `GET /jobs/create`
 - **ルート名**: `jobs.create`
 - **コンポーネント**: `resources/views/livewire/jobs/create.blade.php`
 - **ミドルウェア**: `auth`, `role:company`
 - **機能**: 新規求人投稿
 - **入力項目**:
   - eyecatch: アイキャッチ画像（任意、画像アップロード）
   - howsoon: いつまでに（必須、ラジオボタン：いつか / いますぐにでも / ◯月までに、 "◯月までに"を選択しようとすると、「プロプランに変更してください」というバリデーションメッセージを表示）
   - job_title: やりたいこと（必須、日本語50文字以内、テキストエリア、"〇〇したい"とプレースホルダーで表示）
   - job_detail: 事業内容・困っていること（必須、日本語200文字以内、テキストエリア、"〇〇をしています。✕✕をやりたいが、△△なのでできていません"とプレースホルダーで表示）
   - job_type_id: 募集（必須、ラジオボタン、codesテーブルtype=1、"
採用(有償/雇用)"、"地域おこし協力隊"を選択しようとすると、それぞれ「雇用を目的とした募集はプロプランに変更してください」「地域おこし協力隊募集はプロプランに変更してください」というバリデーションメッセージを表示し、選択をリセット）
   - want_you_id: 希望（任意、チェックボックス、codesテーブルtype=2）
   - job_type_id: できます（任意、チェックボックス、codesテーブルtype=3）
 - **自動設定項目**:
   - company_id: ログインユーザーのID
   - posted_at: 現在日時
 - **バリデーション**（Form Request使用）:
   - title: required, max:100
   - description: required, max:1000
   - employment_type_id: required, exists:codes,type_id（type=1の範囲内）
   - work_style_id: required, exists:codes,type_id（type=2の範囲内）
   - industry_id: required, exists:codes,type_id（type=3の範囲内）
   - location_id: required, exists:locations,id
   - working_hours: required, max:100
   - salary: required, integer, min:0
   - number_of_positions: required, integer, min:1
   - expires_at: nullable, date, after:today
 - **処理**:
   - バリデーション後、job_postsテーブルに登録
   - 登録成功後、求人一覧（jobs.index）にリダイレクト
 - **ポリシー**: `create`アクション（企業ユーザーのみ）
 - **2段階選択の実装**:
   - 都道府県選択時に`wire:model.live="prefecture_id"`を使用
   - prefecture_idが変更されたら市区町村ドロップダウンを動的に更新
   - 市区町村はupdatedPrefectureId()メソッド内で絞り込み
 
 
 - **ルート**: `GET /jobs/{jobPost}/edit`
 - **ルート名**: `jobs.edit`
 - **コンポーネント**: `resources/views/livewire/jobs/edit.blade.php`
 - **ミドルウェア**: `auth`, `role:company`
 - **機能**: 既存募集の編集（自社求人のみ）
 - **入力項目**: 求人登録画面と同じ
 - **既存データ**: プリフィル（初期表示）
   - 勤務地は既存location_idから都道府県と市区町村を取得して表示
 - **posted_at**: 編集時は更新しない（既存値を保持）
 - **バリデーション**: 求人登録画面と同じ
 - **処理**:
   - バリデーション後、job_postsテーブルを更新
   - 更新成功後、求人詳細（jobs.show）にリダイレクト
 - **ポリシー**: `update`アクション（自社求人のみ）
 - **2段階選択の実装**:
   - 都道府県選択時に`wire:model.live="prefecture_id"`を使用
   - prefecture_idが変更されたら市区町村ドロップダウンを動的に更新
   - 市区町村はupdatedPrefectureId()メソッド内で絞り込み
   - mount時に既存のlocation_idから都道府県IDを取得してprefecture_idを設定
 #### 応募一覧画面（ワーカー向け）
 - **ルート**: `GET /applications`
 - **ルート名**: `applications.index`
 - **コンポーネント**: `resources/views/livewire/applications/index.blade.php`
 - **ミドルウェア**: `auth`, `role:worker`
 - **機能**: 自分の応募履歴一覧表示、検索・フィルタ機能
 - **表示内容**:
   - 自分が応募した求人のリスト（1ページ12件）
   - アイキャッチ画像、やりたいこと、期待するサポート、できます、事業者名、所在地など
   - ステータス（バッジ）
   - 応募日
   - 判定日（承認/不承認の場合のみ）
 - **検索・フィルタ機能**:
   - ステータスフィルタ（チェックボックス、applied, accepted, rejected, declined）
   - キーワード検索（求人タイトル、企業名）
   - 並び替え（応募日の新しい順/古い順）
 - **ページネーション**: 1ページ12件
 - **アクション**:
   - 詳細ボタン（常に表示、applications.showへ遷移）
 - **パフォーマンス**: N+1問題対策（`with(['jobPost.company', 'jobPost.employmentType', jobPost.location'])`）
 
 #### 応募詳細画面（ワーカー向け）
 - **ルート**: `GET /applications/{jobApplication}`
 - **ルート名**: `applications.show`
 - **コンポーネント**: `resources/views/livewire/applications/show.blade.php`
 - **ミドルウェア**: `auth`（workerとcompany共通）
 - **機能**: 応募詳細表示、辞退機能（ワーカー）、承認・不承認機能（企業、13.mdで追加）
 - **表示内容**:
   - 応募情報（応募日、ステータス、判定日、辞退日）
   - 募集情報（アイキャッチ画像、やりたいこと、期待するサポート、できます、事業者名、所在地など）
   - この募集が気になった理由は？
   - メッセージ
 - **アクション**:
   - 辞退ボタン（status='applied'の場合のみ）
   - 辞退確認モーダル（「本当に辞退しますか？」）
 - **辞退処理**:
   - statusを'declined'に更新
   - declined_atに現在日時を設定
   - 処理後、応募一覧（applications.index）にリダイレクト
 - **ポリシー**: `view`アクション（自分の応募のみ閲覧可能）
 - **パフォーマンス**: N+1問題対策（`with(['jobPost.company', 'jobPost.employmentType', 'jobPost.workStyle', 'jobPost.industry', 'jobPost.location'])`）
#### 応募一覧画面（企業向け）
- **ルート**: `GET /applications/received`
- **ルート名**: `applications.received`
- **コンポーネント**: `resources/views/livewire/applications/received.blade.php`
- **ミドルウェア**: `auth`, `role:company`
- **機能**: 自社募集への応募一覧表示、検索・フィルタ機能
- **表示内容**:
  - 自社募集への応募リスト（1ページ12件）
  - ワーカー名、応募日、ステータス（バッジ）、判定日
  - 募集タイトル（募集フィルタで「すべて」の場合のみ表示）
- **検索・フィルタ機能**:
  - 募集フィルタ（ドロップダウン）: 「すべて」または特定の募集
  - ステータスフィルタ（チェックボックス: applied, accepted, rejected, declined）
  - キーワード検索（ワーカー名）
  - 並び替え（応募日の新しい順/古い順）
- **ページネーション**: 1ページ12件
- **アクション**:
  - 詳細ボタン（常に表示、applications.showへ遷移）
- **パフォーマンス**: N+1問題対策（`with(['jobPost', 'worker.workerProfile'])`）
- **ルート定義の注意**: 
  - `applications/received`は**動的ルート`applications/{jobApplication}`より前に配置**すること
  - 順序を間違えると403エラーが発生

#### 応募詳細画面に企業向け機能を追加
- **企業向け表示追加**:
  - ワーカー情報カード（企業の場合のみ表示）
    - アイコン、ハンドルネーム、氏名、性別、生年月日、年齢
    - これまでの経験、これからやりたいこと、得意なこと
    - 出身地、現在のお住まい1・2
    - 移住に関心のある地域1・2・3
    - 興味のあるお手伝い
- **企業向けアクション追加**:
  - 承認ボタン（status='applied'の場合のみ）
  - 不承認ボタン（status='applied'の場合のみ）
  - 承認確認モーダル、不承認確認モーダル
- **承認・不承認処理**:
  - statusを'accepted'または'rejected'に更新
  - judged_atに現在日時を設定
  - 処理後、企業向け応募一覧（applications.received）にリダイレクト
- **リレーション追加**: 
  - `worker.workerProfile.*Location`（birthLocation, currentLocation1/2, favoriteLocation1/2/3）
 #### プロジェクト構成
 - 通常のBladeビューとして実装
 - `resources/views/welcome.blade.php`
 - 認証後のリダイレクト先: `/jobs`（募集一覧）
 
 #### ルーティング
 - **ルート**: `GET /`
 - **ルート名**: `welcome`
 - **実装方法**: `routes/web.php`でクロージャとして実装
 - **データ取得**:
   - 最新の求人3件を取得（`JobPost::with(['companyProfile.user', 'location', 'employmentType'])>latest('posted_at')->take(3)->get()`）
   - Eager Loading: companyProfile.user, location, employmentType
 - **ビューに渡すデータ**:
   - `latestJobs`: 最新の募集3件
 - **実装例**:
   ```php
   Route::get('/', function () {
       $latestJobs = JobPost::with(['companyProfile.user', 'location', 'employmentType'])
           ->latest('posted_at')
           ->take(3)
           ->get();
       
       return view('welcome', [
           'latestJobs' => $latestJobs,
       ]);
   })->name('welcome');
   ```
### チャット機能
#### 応募画面の修正（chatRoom自動作成）
- **コンポーネント**: `resources/views/livewire/jobs/apply.blade.php`（11.mdで作成済み）
- **変更内容**: 応募処理成功後にchatRoomを自動作成
- **作成条件**: JobApplicationの作成直後
- **処理フロー**:
  1. 応募データ（JobApplication）を登録
  2. 登録成功後、ChatRoomを作成（application_idを設定）
  3. 求人詳細画面にリダイレクト
- **ChatRoom作成時の設定**:
  - application_id: 作成した応募のID
  - created_at, updated_at: 現在日時

#### チャット一覧画面
- **ルート**: `GET /chats`
- **ルート名**: `chats.index`
- **コンポーネント**: `resources/views/livewire/chats/index.blade.php`
- **ミドルウェア**: `auth`
- **機能**: チャットルーム一覧表示
- **表示内容**:
  - チャットルームのリスト（カード形式）
  - 各カードに以下を表示:
    - 相手の名前（企業：ワーカー名、ワーカー：企業名）
    - 求人タイトル
    - 応募ステータスバッジ（応募中、承認済み、不承認、辞退）
    - 最新メッセージのプレビュー（30文字まで）
    - 最新メッセージの送信日時
    - 未読メッセージ数（バッジ表示）
- **検索機能**:
  - キーワード検索（企業名、求人タイトル、ワーカー名）
  - リアルタイム検索（wire:model.live.debounce.300ms）
- **ソート**:
  - 最新メッセージ順（デフォルト）
- **ページネーション**: 20件/ページ
- **データ取得**:
  - 企業：自社求人への応募のチャットルーム（全ステータス）
  - ワーカー：自分が応募した求人のチャットルーム（全ステータス）
  - Eager Loading: application.jobPost, application.worker, application.jobPost.companyProfile.user, ssages（最新1件のみ）
- **アクション**:
  - チャットルームカードクリック → チャット詳細画面に遷移

#### チャット詳細画面
- **ルート**: `GET /chats/{chatRoom}`
- **ルート名**: `chats.show`
- **コンポーネント**: `resources/views/livewire/chats/show.blade.php`
- **ミドルウェア**: `auth`
- **機能**: メッセージ一覧表示とメッセージ送信
- **表示内容**:
  - 応募情報サマリー:
    - 求人タイトル
    - 企業名
    - ワーカー名
    - 応募ステータスバッジ（応募中、承認済み、不承認、辞退）
  - メッセージ一覧:
    - 時系列順（古い順）
    - 送信者名
    - メッセージ内容
    - 送信日時
    - 既読/未読表示（送信者のみ）
  - メッセージ送信フォーム:
    - テキストエリア（メッセージ入力）
    - 送信ボタン
    - **表示条件**: status='applied'の場合のみ表示
  - 送信不可メッセージ:
    - status='applied'以外の場合に表示
    - 「この応募は{ステータス}のため、メッセージを送信できません。」
- **リアルタイム更新**:
  - 5秒ごとにポーリング（wire:poll.5s）
  - 新しいメッセージを自動取得
- **既読機能**:
  - 画面を開いた時に、自分宛の未読メッセージを既読にする
  - 既読処理はmount時に実行
- **入力項目**:
  - message: メッセージ内容（必須、1000文字以内、テキストエリア）
- **自動設定項目**:
  - chat_room_id: パラメータから取得
  - sender_id: ログインユーザーID
  - is_read: false
  - created_at: 現在日時
- **バリデーション**（Form Request使用）:
  - message: required, max:1000
- **処理**:
  - バリデーション後、messagesテーブルに登録
  - 送信成功後、メッセージリストを更新
  - テキストエリアをクリア
  - 最新メッセージまでスクロール
- **ポリシー**: `view`アクション（チャットルームの参加者のみ閲覧可能）
- **データ取得**:
  - Eager Loading: application.jobPost, application.worker, application.jobPost.companyProfile.user, messages.sender
#### 応募画面の修正（chatRoom自動作成）
- **コンポーネント**: `resources/views/livewire/jobs/apply.blade.php`（11.mdで作成済み）
- **変更内容**: 応募処理成功後にchatRoomを自動作成
- **作成条件**: JobApplicationの作成直後
- **処理フロー**:
  1. 応募データ（JobApplication）を登録
  2. 登録成功後、ChatRoomを作成（application_idを設定）
  3. 求人詳細画面にリダイレクト
- **ChatRoom作成時の設定**:
  - application_id: 作成した応募のID
  - created_at, updated_at: 現在日時

#### チャット一覧画面
- **ルート**: `GET /chats`
- **ルート名**: `chats.index`
- **コンポーネント**: `resources/views/livewire/chats/index.blade.php`
- **ミドルウェア**: `auth`
- **機能**: チャットルーム一覧表示
- **表示内容**:
  - チャットルームのリスト（カード形式）
  - 各カードに以下を表示:
    - 相手の名前（企業：ワーカー名、ワーカー：企業名）
    - 求人タイトル
    - 応募ステータスバッジ（応募中、承認済み、不承認、辞退）
    - 最新メッセージのプレビュー（30文字まで）
    - 最新メッセージの送信日時
    - 未読メッセージ数（バッジ表示）
- **検索機能**:
  - キーワード検索（企業名、求人タイトル、ワーカー名）
  - リアルタイム検索（wire:model.live.debounce.300ms）
- **ソート**:
  - 最新メッセージ順（デフォルト）
- **ページネーション**: 20件/ページ
- **データ取得**:
  - 企業：自社求人への応募のチャットルーム（全ステータス）
  - ワーカー：自分が応募した求人のチャットルーム（全ステータス）
  - Eager Loading: application.jobPost, application.worker, application.jobPost.companyProfile.user, ssages（最新1件のみ）
- **アクション**:
  - チャットルームカードクリック → チャット詳細画面に遷移

#### チャット詳細画面
- **ルート**: `GET /chats/{chatRoom}`
- **ルート名**: `chats.show`
- **コンポーネント**: `resources/views/livewire/chats/show.blade.php`
- **ミドルウェア**: `auth`
- **機能**: メッセージ一覧表示とメッセージ送信
- **表示内容**:
  - 応募情報サマリー:
    - 求人タイトル
    - 企業名
    - ワーカー名
    - 応募ステータスバッジ（応募中、承認済み、不承認、辞退）
  - メッセージ一覧:
    - 時系列順（古い順）
    - 送信者名
    - メッセージ内容
    - 送信日時
    - 既読/未読表示（送信者のみ）
  - メッセージ送信フォーム:
    - テキストエリア（メッセージ入力）
    - 送信ボタン
    - **表示条件**: status='applied'の場合のみ表示
  - 送信不可メッセージ:
    - status='applied'以外の場合に表示
    - 「この応募は{ステータス}のため、メッセージを送信できません。」
- **リアルタイム更新**:
  - 5秒ごとにポーリング（wire:poll.5s）
  - 新しいメッセージを自動取得
- **既読機能**:
  - 画面を開いた時に、自分宛の未読メッセージを既読にする
  - 既読処理はmount時に実行
- **入力項目**:
  - message: メッセージ内容（必須、1000文字以内、テキストエリア）
- **自動設定項目**:
  - chat_room_id: パラメータから取得
  - sender_id: ログインユーザーID
  - is_read: false
  - created_at: 現在日時
- **バリデーション**（Form Request使用）:
  - message: required, max:1000
- **処理**:
  - バリデーション後、messagesテーブルに登録
  - 送信成功後、メッセージリストを更新
  - テキストエリアをクリア
  - 最新メッセージまでスクロール
- **ポリシー**: `view`アクション（チャットルームの参加者のみ閲覧可能）
- **データ取得**:
  - Eager Loading: application.jobPost, application.worker, application.jobPost.companyProfile.user, messages.sender

#### 応募画面の修正（chatRoom自動作成）
- **コンポーネント**: `resources/views/livewire/jobs/apply.blade.php`（11.mdで作成み）
- **変更内容**: 応募処理成功後にchatRoomを自動作成
- **作成条件**: JobApplicationの作成直後
- **処理フロー**:
  1. 応募データ（JobApplication）を登録
  2. 登録成功後、ChatRoomを作成（application_idを設定）
  3. 求人詳細画面にリダイレクト
- **ChatRoom作成時の設定**:
  - application_id: 作成した応募のID
  - created_at, updated_at: 現在日時

#### チャット一覧画面
- **ルート**: `GET /chats`
- **ルート名**: `chats.index`
- **コンポーネント**: `resources/views/livewire/chats/index.blade.php`
- **ミドルウェア**: `auth`
- **機能**: チャットルーム一覧表示
- **表示内容**:
  - チャットルームのリスト（カード形式）
  - 各カードに以下を表示:
    - 相手の名前（企業：ワーカー名、ワーカー：企業名）
    - 求人タイトル
    - 応募ステータスバッジ（応募中、承認済み、不承認、辞退）
    - 最新メッセージのプレビュー（30文字まで）
    - 最新メッセージの送信日時
    - 未読メッセージ数（バッジ表示）
- **検索機能**:
  - キーワード検索（企業名、求人タイトル、ワーカー名）
  - リアルタイム検索（wire:model.live.debounce.300ms）
- **ソート**:
  - 最新メッセージ順（デフォルト）
- **ページネーション**: 20件/ページ
- **データ取得**:
  - 企業：自社求人への応募のチャットルーム（全ステータス）
  - ワーカー：自分が応募した求人のチャットルーム（全ステータス）
  - Eager Loading: application.jobPost, application.worker, application.jobPost.mpanyProfile.user, messages（最新1件のみ）
- **アクション**:
  - チャットルームカードクリック → チャット詳細画面に遷移

#### チャット詳細画面
- **ルート**: `GET /chats/{chatRoom}`
- **ルート名**: `chats.show`
- **コンポーネント**: `resources/views/livewire/chats/show.blade.php`
- **ミドルウェア**: `auth`
- **機能**: メッセージ一覧表示とメッセージ送信
- **表示内容**:
  - 応募情報サマリー:
    - 求人タイトル
    - 企業名
    - ワーカー名
    - 応募ステータスバッジ（応募中、承認済み、不承認、辞退）
  - メッセージ一覧:
    - 時系列順（古い順）
    - 送信者名
    - メッセージ内容
    - 送信日時
    - 既読/未読表示（送信者のみ）
  - メッセージ送信フォーム:
    - テキストエリア（メッセージ入力）
    - 送信ボタン
    - **表示条件**: status='applied'の場合のみ表示
  - 送信不可メッセージ:
    - status='applied'以外の場合に表示
    - 「この応募は{ステータス}のため、メッセージを送信できません。」
- **リアルタイム更新**:
  - 5秒ごとにポーリング（wire:poll.5s）
  - 新しいメッセージを自動取得
- **既読機能**:
  - 画面を開いた時に、自分宛の未読メッセージを既読にする
  - 既読処理はmount時に実行
- **入力項目**:
  - message: メッセージ内容（必須、1000文字以内、テキストエリア）
- **自動設定項目**:
  - chat_room_id: パラメータから取得
  - sender_id: ログインユーザーID
  - is_read: false
  - created_at: 現在日時
- **バリデーション**（Form Request使用）:
  - message: required, max:1000
- **処理**:
  - バリデーション後、messagesテーブルに登録
  - 送信成功後、メッセージリストを更新
  - テキストエリアをクリア
  - 最新メッセージまでスクロール
- **ポリシー**: `view`アクション（チャットルームの参加者のみ閲覧可能）
- **データ取得**:
  - Eager Loading: application.jobPost, application.worker, application.jobPost.companyProfile.user, messages.sender

 #### デザイン
 - やさしく温かみのある印象で、地方との心理的距離を縮めるデザイン
 - 配色設計：
  - ベージュ系（背景）
    -  全体のベースカラーとして使用し、紙・土・木を連想させることで「暮らし」「日常」「安心感」を演出。長時間の閲覧でも疲れにくい。
  - オレンジ（アクセント）
    -  見出しの強調やCTAに使用。人の温度感・会話・一歩踏み出す勇気を象徴し、「旅のついでに」「話を聞きに行く」といった軽やかな行動喚起を担う。
  -  グリーン（キーワード強調）
    -  「地方」「自然」「地域」を象徴する色として、都市部（オレンジ）との対比に活用。都市と地方の“つながり”を色で直感的に理解させる役割。
  -  ダークブラウン／ブラック（本文テキスト）
    -  純粋な黒ではなく柔らかい濃色を使用し、可読性を保ちながら全体のトーンを穏やかに統一。
 - レスポンシブ対応
 - スクロールアニメーション
 - インタラクティブな要素
 - 手書き風フォントと丸みのある文字組みによる、親しみやすいトーン
 - ファーストビューでコンセプトが直感的に伝わるコピー設計
 - スマートフォン閲覧を前提とした縦スクロール中心のUI設計
 - 写真を大きく使い、実在感・生活感・現場感を強調
 - カード型UIによる事例紹介で、利用イメージを具体化

 #### 構成
 - **ヘッダー：**
   - ロゴ画像(logo.png)を表示 
   - サイト名「ふるぼの」をテキストで表示
   - ナビゲーションメニュー：
     - 地域の募集（#jobs へのアンカーリンク）
     - ログイン（/login へのリンク、CTAボタンスタイル）
   - モバイル時：ハンバーガーメニュー
 
 - **ヒーローセクション：**
   - 大きな見出し：「いつかやりたい」で地方とつながる
   - サブタイトル：ふるさとプロボノサービス
   - ファーストビュー画像(fv.png)を表示
   - 背景：オレンジ系のグラデーション
  
 - **募集情報セクション（#jobs）：**
   - 見出し: 「全国の地域から」
   - サブタイトル: 「新着の募集をチェックしましょう」
   - 最新の募集3件をカード形式で表示
   - 各求人カードに表示する項目：
     - アイキャッチ画像
     - やりたいこと
     - 所在地（都道府県 + 市区町村）
   - 各カードはクリック可能（/jobs/{id} へのリンク）
   - 「もっと見る」ボタン（/jobs へのリンク）
   - 募集が存在しない場合：「現在、募集はありません」と表示
 
 - **フッター：**
   - 2カラム表示（モバイルは1カラム）：
   - コピーライト：「© 2025 MEKABU.co. All rights reserved.」
   - プライバシーポリシー（https://mekabu.tech/privacy-policy への外部リンク）
 
 #### 使用技術
 - Laravel Blade（テンプレートエンジン）
 - Tailwind CSS（スタイリング）
 - Alpine.js（インタラクティブ要素）
 - Google Fonts（Noto Sans JP）: `https://fonts.bunny.net/css?family=noto-sans-jp:400,500,600,00`
 - Font Awesome（アイコン、CDN）: `https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/ss/all.min.css`
 
 #### SEO対策
 - `<title>`: 「ふるぼの - ふるさとプロボノ」
 - `<meta name="description">`: 「"いつかやりたい"で地方とつながる」
 
 #### アクセシビリティ
 - セマンティックHTMLの使用
 - 画像のalt属性を必ず設定
 - リンクには適切なaria-labelを使用
 - キーボード操作対応
 - コントラスト比の確保（WCAG AA基準）
